

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Computation with Xarray &mdash; Xarray Tutorial  documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Plotting and Visualization" href="04_plotting_and_visualization.html" />
    <link rel="prev" title="Working with labeled data" href="02_working_with_labeled_data.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home" alt="Documentation Home"> Xarray Tutorial
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="00_overview.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="01_datastructures_and_io.html">Data structures for multi-dimensional data</a></li>
<li class="toctree-l1"><a class="reference internal" href="02_working_with_labeled_data.html">Working with labeled data</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Computation with Xarray</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#Example-Dataset">Example Dataset</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Basic-Arithmetic">Basic Arithmetic</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Applying-Aribtrary-Functions">Applying Aribtrary Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Reductions">Reductions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Exercise">Exercise</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#Broadcasting">Broadcasting</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Weighted-Reductions">Weighted Reductions</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Groupby">Groupby</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Aggregations">Aggregations</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Transformations">Transformations</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#Grouby-Related:-Resample,-Rolling,-Coarsen">Grouby-Related: Resample, Rolling, Coarsen</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id1">Exercise</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="04_plotting_and_visualization.html">Plotting and Visualization</a></li>
<li class="toctree-l1"><a class="reference internal" href="05_intro_to_dask.html">Introduction to Dask</a></li>
<li class="toctree-l1"><a class="reference internal" href="06_xarray_and_dask.html">Xarray and Dask</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Xarray Tutorial</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Computation with Xarray</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/scipy-tutorial/03_computation_with_xarray.ipynb.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container,
div.nbinput.container div.prompt,
div.nbinput.container div.input_area,
div.nbinput.container div[class*=highlight],
div.nbinput.container div[class*=highlight] pre,
div.nboutput.container,
div.nboutput.container div.prompt,
div.nboutput.container div.output_area,
div.nboutput.container div[class*=highlight],
div.nboutput.container div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    background: #f5f5f5;
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<p>You can run this notebook in a <a class="reference external" href="https://mybinder.org/v2/gh/xarray-contrib/xarray-tutorial/master?urlpath=lab/tree/scipy-tutorial/03_computation_with_xarray.ipynb">live session</a> <a class="reference external" href="https://mybinder.org/v2/gh/xarray-contrib/xarray-tutorial/master?urlpath=lab/tree/scipy-tutorial/03_computation_with_xarray.ipynb"><img alt="Binder" src="https://mybinder.org/badge_logo.svg" /></a> or view it <a class="reference external" href="https://github.com/xarray-contrib/xarray-tutorial/blob/master/scipy-tutorial/03_computation_with_xarray.ipynb">on Github</a>.</p>
<p><img alt="b7cae19adbd64f89b02435b3cc3d2af6" class="no-scaled-link" src="http://xarray.pydata.org/en/stable/_static/dataset-diagram-logo.png" style="width: 30%;" /></p>
<div class="section" id="Computation-with-Xarray">
<h1>Computation with Xarray<a class="headerlink" href="#Computation-with-Xarray" title="Permalink to this headline">¶</a></h1>
<p>In this lesson, we discuss how to do scientific computations with xarray objects. Our learning goals are as follows. By the end of the lesson, we will be able to:</p>
<ul class="simple">
<li><p>Apply basic arithmetic and numpy functions to xarray DataArrays / Dataset.</p></li>
<li><p>Use Xarray’s label-aware reduction operations (e.g. <code class="docutils literal notranslate"><span class="pre">mean</span></code>, <code class="docutils literal notranslate"><span class="pre">sum</span></code>) weighted reductions.</p></li>
<li><p>Apply arbitrary functions to Xarray data via <code class="docutils literal notranslate"><span class="pre">apply_ufunc</span></code>.</p></li>
<li><p>Use Xarray’s broadcasting to compute on arrays of different dimensionality.</p></li>
<li><p>Perform “split / apply / combine” workflows in Xarray using <code class="docutils literal notranslate"><span class="pre">groupby</span></code>, including</p>
<ul>
<li><p>reductions within groups</p></li>
<li><p>transformations on groups</p></li>
</ul>
</li>
<li><p>Use the <code class="docutils literal notranslate"><span class="pre">resample</span></code>, <code class="docutils literal notranslate"><span class="pre">rolling</span></code> and <code class="docutils literal notranslate"><span class="pre">coarsen</span></code> functions to manipulate data.</p></li>
</ul>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">expectexception</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">xarray</span> <span class="k">as</span> <span class="nn">xr</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
</pre></div>
</div>
</div>
<div class="section" id="Example-Dataset">
<h2>Example Dataset<a class="headerlink" href="#Example-Dataset" title="Permalink to this headline">¶</a></h2>
<p>First we load a dataset. We will use the <a class="reference external" href="https://www.ncdc.noaa.gov/data-access/marineocean-data/extended-reconstructed-sea-surface-temperature-ersst-v5">NOAA Extended Reconstructed Sea Surface Temperature (ERSST) v5</a> product, a widely used and trusted gridded compilation of of historical data going back to 1854.</p>
<p>Since the data is provided via an <a class="reference external" href="https://en.wikipedia.org/wiki/OPeNDAP">OPeNDAP</a> server, we can load it directly without downloading anything:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">### NOTE: If hundreds of people connect to this server at once and download the same dataset,</span>
<span class="c1">###       things might not go so well! Recommended to use the Google Cloud copy instead.</span>

<span class="c1"># url = &quot;http://www.esrl.noaa.gov/psd/thredds/dodsC/Datasets/noaa.ersst.v5/sst.mnmean.nc&quot;</span>
<span class="c1"># # drop an unnecessary variable which complicates some operations</span>
<span class="c1"># ds = xr.open_dataset(url, drop_variables=[&quot;time_bnds&quot;])</span>
<span class="c1"># # will take a minute or two to complete</span>
<span class="c1"># ds = ds.sel(time=slice(&quot;1960&quot;, &quot;2018&quot;)).load()</span>
<span class="c1"># ds</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">gcsfs</span>

<span class="n">fs</span> <span class="o">=</span> <span class="n">gcsfs</span><span class="o">.</span><span class="n">GCSFileSystem</span><span class="p">()</span>
<span class="n">ds</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_zarr</span><span class="p">(</span>
    <span class="n">fs</span><span class="o">.</span><span class="n">get_mapper</span><span class="p">(</span><span class="s2">&quot;gs://pangeo-noaa-ncei/noaa.ersst.v5.zarr&quot;</span><span class="p">),</span> <span class="n">consolidated</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
<span class="n">ds</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
_call out of retries on exception: (&#39;Failed to retrieve http://metadata.google.internal/computeMetadata/v1/instance/service-accounts/default/?recursive=true from the Google Compute Enginemetadata service. Status: 404 Response:\nb\&#39;&lt;!DOCTYPE html&gt;\\n&lt;html lang=en&gt;\\n  &lt;meta charset=utf-8&gt;\\n  &lt;meta name=viewport content=&#34;initial-scale=1, minimum-scale=1, width=device-width&#34;&gt;\\n  &lt;title&gt;Error 404 (Not Found)!!1&lt;/title&gt;\\n  &lt;style&gt;\\n    *{margin:0;padding:0}html,code{font:15px/22px arial,sans-serif}html{background:#fff;color:#222;padding:15px}body{margin:7% auto 0;max-width:390px;min-height:180px;padding:30px 0 15px}* &gt; body{background:url(//www.google.com/images/errors/robot.png) 100% 5px no-repeat;padding-right:205px}p{margin:11px 0 22px;overflow:hidden}ins{color:#777;text-decoration:none}a img{border:0}@media screen and (max-width:772px){body{background:none;margin-top:0;max-width:none;padding-right:0}}#logo{background:url(//www.google.com/images/branding/googlelogo/1x/googlelogo_color_150x54dp.png) no-repeat;margin-left:-5px}@media only screen and (min-resolution:192dpi){#logo{background:url(//www.google.com/images/branding/googlelogo/2x/googlelogo_color_150x54dp.png) no-repeat 0% 0%/100% 100%;-moz-border-image:url(//www.google.com/images/branding/googlelogo/2x/googlelogo_color_150x54dp.png) 0}}@media only screen and (-webkit-min-device-pixel-ratio:2){#logo{background:url(//www.google.com/images/branding/googlelogo/2x/googlelogo_color_150x54dp.png) no-repeat;-webkit-background-size:100% 100%}}#logo{display:inline-block;height:54px;width:150px}\\n  &lt;/style&gt;\\n  &lt;a href=//www.google.com/&gt;&lt;span id=logo aria-label=Google&gt;&lt;/span&gt;&lt;/a&gt;\\n  &lt;p&gt;&lt;b&gt;404.&lt;/b&gt; &lt;ins&gt;That\\xe2\\x80\\x99s an error.&lt;/ins&gt;\\n  &lt;p&gt;The requested URL &lt;code&gt;/computeMetadata/v1/instance/service-accounts/default/?recursive=true&lt;/code&gt; was not found on this server.  &lt;ins&gt;That\\xe2\\x80\\x99s all we know.&lt;/ins&gt;\\n\&#39;&#39;, &lt;google.auth.transport.requests._Response object at 0x7f7eecbaad60&gt;)
Traceback (most recent call last):
  File &#34;/home/travis/miniconda/envs/xarray/lib/python3.8/site-packages/google/auth/compute_engine/credentials.py&#34;, line 96, in refresh
    self._retrieve_info(request)
  File &#34;/home/travis/miniconda/envs/xarray/lib/python3.8/site-packages/google/auth/compute_engine/credentials.py&#34;, line 76, in _retrieve_info
    info = _metadata.get_service_account_info(
  File &#34;/home/travis/miniconda/envs/xarray/lib/python3.8/site-packages/google/auth/compute_engine/_metadata.py&#34;, line 223, in get_service_account_info
    return get(
  File &#34;/home/travis/miniconda/envs/xarray/lib/python3.8/site-packages/google/auth/compute_engine/_metadata.py&#34;, line 174, in get
    raise exceptions.TransportError(
google.auth.exceptions.TransportError: (&#39;Failed to retrieve http://metadata.google.internal/computeMetadata/v1/instance/service-accounts/default/?recursive=true from the Google Compute Enginemetadata service. Status: 404 Response:\nb\&#39;&lt;!DOCTYPE html&gt;\\n&lt;html lang=en&gt;\\n  &lt;meta charset=utf-8&gt;\\n  &lt;meta name=viewport content=&#34;initial-scale=1, minimum-scale=1, width=device-width&#34;&gt;\\n  &lt;title&gt;Error 404 (Not Found)!!1&lt;/title&gt;\\n  &lt;style&gt;\\n    *{margin:0;padding:0}html,code{font:15px/22px arial,sans-serif}html{background:#fff;color:#222;padding:15px}body{margin:7% auto 0;max-width:390px;min-height:180px;padding:30px 0 15px}* &gt; body{background:url(//www.google.com/images/errors/robot.png) 100% 5px no-repeat;padding-right:205px}p{margin:11px 0 22px;overflow:hidden}ins{color:#777;text-decoration:none}a img{border:0}@media screen and (max-width:772px){body{background:none;margin-top:0;max-width:none;padding-right:0}}#logo{background:url(//www.google.com/images/branding/googlelogo/1x/googlelogo_color_150x54dp.png) no-repeat;margin-left:-5px}@media only screen and (min-resolution:192dpi){#logo{background:url(//www.google.com/images/branding/googlelogo/2x/googlelogo_color_150x54dp.png) no-repeat 0% 0%/100% 100%;-moz-border-image:url(//www.google.com/images/branding/googlelogo/2x/googlelogo_color_150x54dp.png) 0}}@media only screen and (-webkit-min-device-pixel-ratio:2){#logo{background:url(//www.google.com/images/branding/googlelogo/2x/googlelogo_color_150x54dp.png) no-repeat;-webkit-background-size:100% 100%}}#logo{display:inline-block;height:54px;width:150px}\\n  &lt;/style&gt;\\n  &lt;a href=//www.google.com/&gt;&lt;span id=logo aria-label=Google&gt;&lt;/span&gt;&lt;/a&gt;\\n  &lt;p&gt;&lt;b&gt;404.&lt;/b&gt; &lt;ins&gt;That\\xe2\\x80\\x99s an error.&lt;/ins&gt;\\n  &lt;p&gt;The requested URL &lt;code&gt;/computeMetadata/v1/instance/service-accounts/default/?recursive=true&lt;/code&gt; was not found on this server.  &lt;ins&gt;That\\xe2\\x80\\x99s all we know.&lt;/ins&gt;\\n\&#39;&#39;, &lt;google.auth.transport.requests._Response object at 0x7f7eecbaad60&gt;)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File &#34;/home/travis/miniconda/envs/xarray/lib/python3.8/site-packages/gcsfs/core.py&#34;, line 478, in _call
    r = self.session.request(
  File &#34;/home/travis/miniconda/envs/xarray/lib/python3.8/site-packages/google/auth/transport/requests.py&#34;, line 440, in request
    self.credentials.before_request(auth_request, method, url, request_headers)
  File &#34;/home/travis/miniconda/envs/xarray/lib/python3.8/site-packages/google/auth/credentials.py&#34;, line 124, in before_request
    self.refresh(request)
  File &#34;/home/travis/miniconda/envs/xarray/lib/python3.8/site-packages/google/auth/compute_engine/credentials.py&#34;, line 102, in refresh
    six.raise_from(new_exc, caught_exc)
  File &#34;&lt;string&gt;&#34;, line 3, in raise_from
google.auth.exceptions.RefreshError: (&#39;Failed to retrieve http://metadata.google.internal/computeMetadata/v1/instance/service-accounts/default/?recursive=true from the Google Compute Enginemetadata service. Status: 404 Response:\nb\&#39;&lt;!DOCTYPE html&gt;\\n&lt;html lang=en&gt;\\n  &lt;meta charset=utf-8&gt;\\n  &lt;meta name=viewport content=&#34;initial-scale=1, minimum-scale=1, width=device-width&#34;&gt;\\n  &lt;title&gt;Error 404 (Not Found)!!1&lt;/title&gt;\\n  &lt;style&gt;\\n    *{margin:0;padding:0}html,code{font:15px/22px arial,sans-serif}html{background:#fff;color:#222;padding:15px}body{margin:7% auto 0;max-width:390px;min-height:180px;padding:30px 0 15px}* &gt; body{background:url(//www.google.com/images/errors/robot.png) 100% 5px no-repeat;padding-right:205px}p{margin:11px 0 22px;overflow:hidden}ins{color:#777;text-decoration:none}a img{border:0}@media screen and (max-width:772px){body{background:none;margin-top:0;max-width:none;padding-right:0}}#logo{background:url(//www.google.com/images/branding/googlelogo/1x/googlelogo_color_150x54dp.png) no-repeat;margin-left:-5px}@media only screen and (min-resolution:192dpi){#logo{background:url(//www.google.com/images/branding/googlelogo/2x/googlelogo_color_150x54dp.png) no-repeat 0% 0%/100% 100%;-moz-border-image:url(//www.google.com/images/branding/googlelogo/2x/googlelogo_color_150x54dp.png) 0}}@media only screen and (-webkit-min-device-pixel-ratio:2){#logo{background:url(//www.google.com/images/branding/googlelogo/2x/googlelogo_color_150x54dp.png) no-repeat;-webkit-background-size:100% 100%}}#logo{display:inline-block;height:54px;width:150px}\\n  &lt;/style&gt;\\n  &lt;a href=//www.google.com/&gt;&lt;span id=logo aria-label=Google&gt;&lt;/span&gt;&lt;/a&gt;\\n  &lt;p&gt;&lt;b&gt;404.&lt;/b&gt; &lt;ins&gt;That\\xe2\\x80\\x99s an error.&lt;/ins&gt;\\n  &lt;p&gt;The requested URL &lt;code&gt;/computeMetadata/v1/instance/service-accounts/default/?recursive=true&lt;/code&gt; was not found on this server.  &lt;ins&gt;That\\xe2\\x80\\x99s all we know.&lt;/ins&gt;\\n\&#39;&#39;, &lt;google.auth.transport.requests._Response object at 0x7f7eecbaad60&gt;)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">TransportError</span>                            Traceback (most recent call last)
<span class="ansi-green-fg">~/miniconda/envs/xarray/lib/python3.8/site-packages/google/auth/compute_engine/credentials.py</span> in <span class="ansi-cyan-fg">refresh</span><span class="ansi-blue-fg">(self, request)</span>
<span class="ansi-green-intense-fg ansi-bold">     95</span>         <span class="ansi-green-fg">try</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">---&gt; 96</span><span class="ansi-red-fg">             </span>self<span class="ansi-blue-fg">.</span>_retrieve_info<span class="ansi-blue-fg">(</span>request<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     97</span>             self.token, self.expiry = _metadata.get_service_account_token(

<span class="ansi-green-fg">~/miniconda/envs/xarray/lib/python3.8/site-packages/google/auth/compute_engine/credentials.py</span> in <span class="ansi-cyan-fg">_retrieve_info</span><span class="ansi-blue-fg">(self, request)</span>
<span class="ansi-green-intense-fg ansi-bold">     75</span>         &#34;&#34;&#34;
<span class="ansi-green-fg">---&gt; 76</span><span class="ansi-red-fg">         info = _metadata.get_service_account_info(
</span><span class="ansi-green-intense-fg ansi-bold">     77</span>             request<span class="ansi-blue-fg">,</span> service_account<span class="ansi-blue-fg">=</span>self<span class="ansi-blue-fg">.</span>_service_account_email

<span class="ansi-green-fg">~/miniconda/envs/xarray/lib/python3.8/site-packages/google/auth/compute_engine/_metadata.py</span> in <span class="ansi-cyan-fg">get_service_account_info</span><span class="ansi-blue-fg">(request, service_account)</span>
<span class="ansi-green-intense-fg ansi-bold">    222</span>     &#34;&#34;&#34;
<span class="ansi-green-fg">--&gt; 223</span><span class="ansi-red-fg">     return get(
</span><span class="ansi-green-intense-fg ansi-bold">    224</span>         request<span class="ansi-blue-fg">,</span>

<span class="ansi-green-fg">~/miniconda/envs/xarray/lib/python3.8/site-packages/google/auth/compute_engine/_metadata.py</span> in <span class="ansi-cyan-fg">get</span><span class="ansi-blue-fg">(request, path, root, recursive, retry_count)</span>
<span class="ansi-green-intense-fg ansi-bold">    173</span>     <span class="ansi-green-fg">else</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 174</span><span class="ansi-red-fg">         raise exceptions.TransportError(
</span><span class="ansi-green-intense-fg ansi-bold">    175</span>             <span class="ansi-blue-fg">&#34;Failed to retrieve {} from the Google Compute Engine&#34;</span>

<span class="ansi-red-fg">TransportError</span>: (&#39;Failed to retrieve http://metadata.google.internal/computeMetadata/v1/instance/service-accounts/default/?recursive=true from the Google Compute Enginemetadata service. Status: 404 Response:\nb\&#39;&lt;!DOCTYPE html&gt;\\n&lt;html lang=en&gt;\\n  &lt;meta charset=utf-8&gt;\\n  &lt;meta name=viewport content=&#34;initial-scale=1, minimum-scale=1, width=device-width&#34;&gt;\\n  &lt;title&gt;Error 404 (Not Found)!!1&lt;/title&gt;\\n  &lt;style&gt;\\n    *{margin:0;padding:0}html,code{font:15px/22px arial,sans-serif}html{background:#fff;color:#222;padding:15px}body{margin:7% auto 0;max-width:390px;min-height:180px;padding:30px 0 15px}* &gt; body{background:url(//www.google.com/images/errors/robot.png) 100% 5px no-repeat;padding-right:205px}p{margin:11px 0 22px;overflow:hidden}ins{color:#777;text-decoration:none}a img{border:0}@media screen and (max-width:772px){body{background:none;margin-top:0;max-width:none;padding-right:0}}#logo{background:url(//www.google.com/images/branding/googlelogo/1x/googlelogo_color_150x54dp.png) no-repeat;margin-left:-5px}@media only screen and (min-resolution:192dpi){#logo{background:url(//www.google.com/images/branding/googlelogo/2x/googlelogo_color_150x54dp.png) no-repeat 0% 0%/100% 100%;-moz-border-image:url(//www.google.com/images/branding/googlelogo/2x/googlelogo_color_150x54dp.png) 0}}@media only screen and (-webkit-min-device-pixel-ratio:2){#logo{background:url(//www.google.com/images/branding/googlelogo/2x/googlelogo_color_150x54dp.png) no-repeat;-webkit-background-size:100% 100%}}#logo{display:inline-block;height:54px;width:150px}\\n  &lt;/style&gt;\\n  &lt;a href=//www.google.com/&gt;&lt;span id=logo aria-label=Google&gt;&lt;/span&gt;&lt;/a&gt;\\n  &lt;p&gt;&lt;b&gt;404.&lt;/b&gt; &lt;ins&gt;That\\xe2\\x80\\x99s an error.&lt;/ins&gt;\\n  &lt;p&gt;The requested URL &lt;code&gt;/computeMetadata/v1/instance/service-accounts/default/?recursive=true&lt;/code&gt; was not found on this server.  &lt;ins&gt;That\\xe2\\x80\\x99s all we know.&lt;/ins&gt;\\n\&#39;&#39;, &lt;google.auth.transport.requests._Response object at 0x7f7eecbaad60&gt;)

The above exception was the direct cause of the following exception:

<span class="ansi-red-fg">RefreshError</span>                              Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-3-0da352ffa899&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-intense-fg ansi-bold">      2</span>
<span class="ansi-green-intense-fg ansi-bold">      3</span> fs <span class="ansi-blue-fg">=</span> gcsfs<span class="ansi-blue-fg">.</span>GCSFileSystem<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">----&gt; 4</span><span class="ansi-red-fg"> ds = xr.open_zarr(
</span><span class="ansi-green-intense-fg ansi-bold">      5</span>     fs<span class="ansi-blue-fg">.</span>get_mapper<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">&#34;gs://pangeo-noaa-ncei/noaa.ersst.v5.zarr&#34;</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">,</span> consolidated<span class="ansi-blue-fg">=</span><span class="ansi-green-fg">True</span>
<span class="ansi-green-intense-fg ansi-bold">      6</span> ).load()

<span class="ansi-green-fg">~/miniconda/envs/xarray/lib/python3.8/site-packages/xarray/backends/zarr.py</span> in <span class="ansi-cyan-fg">open_zarr</span><span class="ansi-blue-fg">(store, group, synchronizer, chunks, decode_cf, mask_and_scale, decode_times, concat_characters, decode_coords, drop_variables, consolidated, overwrite_encoded_chunks, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">    590</span>     <span class="ansi-red-fg"># reads or writes from a store, never both. For open_zarr, we only read</span>
<span class="ansi-green-intense-fg ansi-bold">    591</span>     mode <span class="ansi-blue-fg">=</span> <span class="ansi-blue-fg">&#34;r&#34;</span>
<span class="ansi-green-fg">--&gt; 592</span><span class="ansi-red-fg">     zarr_store = ZarrStore.open_group(
</span><span class="ansi-green-intense-fg ansi-bold">    593</span>         store<span class="ansi-blue-fg">,</span>
<span class="ansi-green-intense-fg ansi-bold">    594</span>         mode<span class="ansi-blue-fg">=</span>mode<span class="ansi-blue-fg">,</span>

<span class="ansi-green-fg">~/miniconda/envs/xarray/lib/python3.8/site-packages/xarray/backends/zarr.py</span> in <span class="ansi-cyan-fg">open_group</span><span class="ansi-blue-fg">(cls, store, mode, synchronizer, group, consolidated, consolidate_on_close)</span>
<span class="ansi-green-intense-fg ansi-bold">    257</span>         <span class="ansi-green-fg">if</span> consolidated<span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    258</span>             <span class="ansi-red-fg"># TODO: an option to pass the metadata_key keyword</span>
<span class="ansi-green-fg">--&gt; 259</span><span class="ansi-red-fg">             </span>zarr_group <span class="ansi-blue-fg">=</span> zarr<span class="ansi-blue-fg">.</span>open_consolidated<span class="ansi-blue-fg">(</span>store<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>open_kwargs<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    260</span>         <span class="ansi-green-fg">else</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    261</span>             zarr_group <span class="ansi-blue-fg">=</span> zarr<span class="ansi-blue-fg">.</span>open_group<span class="ansi-blue-fg">(</span>store<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>open_kwargs<span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">~/miniconda/envs/xarray/lib/python3.8/site-packages/zarr/convenience.py</span> in <span class="ansi-cyan-fg">open_consolidated</span><span class="ansi-blue-fg">(store, metadata_key, mode, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">   1177</span>
<span class="ansi-green-intense-fg ansi-bold">   1178</span>     <span class="ansi-red-fg"># setup metadata sotre</span>
<span class="ansi-green-fg">-&gt; 1179</span><span class="ansi-red-fg">     </span>meta_store <span class="ansi-blue-fg">=</span> ConsolidatedMetadataStore<span class="ansi-blue-fg">(</span>store<span class="ansi-blue-fg">,</span> metadata_key<span class="ansi-blue-fg">=</span>metadata_key<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">   1180</span>
<span class="ansi-green-intense-fg ansi-bold">   1181</span>     <span class="ansi-red-fg"># pass through</span>

<span class="ansi-green-fg">~/miniconda/envs/xarray/lib/python3.8/site-packages/zarr/storage.py</span> in <span class="ansi-cyan-fg">__init__</span><span class="ansi-blue-fg">(self, store, metadata_key)</span>
<span class="ansi-green-intense-fg ansi-bold">   2499</span>
<span class="ansi-green-intense-fg ansi-bold">   2500</span>         <span class="ansi-red-fg"># retrieve consolidated metadata</span>
<span class="ansi-green-fg">-&gt; 2501</span><span class="ansi-red-fg">         </span>meta <span class="ansi-blue-fg">=</span> json_loads<span class="ansi-blue-fg">(</span>store<span class="ansi-blue-fg">[</span>metadata_key<span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">   2502</span>
<span class="ansi-green-intense-fg ansi-bold">   2503</span>         <span class="ansi-red-fg"># check format of consolidated metadata</span>

<span class="ansi-green-fg">~/miniconda/envs/xarray/lib/python3.8/site-packages/fsspec/mapping.py</span> in <span class="ansi-cyan-fg">__getitem__</span><span class="ansi-blue-fg">(self, key, default)</span>
<span class="ansi-green-intense-fg ansi-bold">     73</span>         k <span class="ansi-blue-fg">=</span> self<span class="ansi-blue-fg">.</span>_key_to_str<span class="ansi-blue-fg">(</span>key<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     74</span>         <span class="ansi-green-fg">try</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">---&gt; 75</span><span class="ansi-red-fg">             </span>result <span class="ansi-blue-fg">=</span> self<span class="ansi-blue-fg">.</span>fs<span class="ansi-blue-fg">.</span>cat<span class="ansi-blue-fg">(</span>k<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     76</span>         <span class="ansi-green-fg">except</span> <span class="ansi-blue-fg">(</span>FileNotFoundError<span class="ansi-blue-fg">,</span> IsADirectoryError<span class="ansi-blue-fg">,</span> NotADirectoryError<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">     77</span>             <span class="ansi-green-fg">if</span> default <span class="ansi-green-fg">is</span> <span class="ansi-green-fg">not</span> <span class="ansi-green-fg">None</span><span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">~/miniconda/envs/xarray/lib/python3.8/site-packages/gcsfs/core.py</span> in <span class="ansi-cyan-fg">cat</span><span class="ansi-blue-fg">(self, path)</span>
<span class="ansi-green-intense-fg ansi-bold">    783</span>         <span class="ansi-blue-fg">&#34;&#34;&#34; Simple one-shot get of file data &#34;&#34;&#34;</span>
<span class="ansi-green-intense-fg ansi-bold">    784</span>         u2 <span class="ansi-blue-fg">=</span> self<span class="ansi-blue-fg">.</span>url<span class="ansi-blue-fg">(</span>path<span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">--&gt; 785</span><span class="ansi-red-fg">         </span>r <span class="ansi-blue-fg">=</span> self<span class="ansi-blue-fg">.</span>_call<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">&#34;GET&#34;</span><span class="ansi-blue-fg">,</span> u2<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    786</span>         r<span class="ansi-blue-fg">.</span>raise_for_status<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    787</span>         <span class="ansi-green-fg">if</span> <span class="ansi-blue-fg">&#34;X-Goog-Hash&#34;</span> <span class="ansi-green-fg">in</span> r<span class="ansi-blue-fg">.</span>headers<span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">~/miniconda/envs/xarray/lib/python3.8/site-packages/gcsfs/core.py</span> in <span class="ansi-cyan-fg">_call</span><span class="ansi-blue-fg">(self, method, path, *args, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">    497</span>                 <span class="ansi-green-fg">if</span> retry <span class="ansi-blue-fg">==</span> self<span class="ansi-blue-fg">.</span>retries <span class="ansi-blue-fg">-</span> <span class="ansi-cyan-fg">1</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    498</span>                     logger<span class="ansi-blue-fg">.</span>exception<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">&#34;_call out of retries on exception: %s&#34;</span><span class="ansi-blue-fg">,</span> e<span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">--&gt; 499</span><span class="ansi-red-fg">                     </span><span class="ansi-green-fg">raise</span> e
<span class="ansi-green-intense-fg ansi-bold">    500</span>                 <span class="ansi-green-fg">if</span> is_retriable<span class="ansi-blue-fg">(</span>e<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    501</span>                     logger<span class="ansi-blue-fg">.</span>debug<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">&#34;_call retrying after exception: %s&#34;</span><span class="ansi-blue-fg">,</span> e<span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">~/miniconda/envs/xarray/lib/python3.8/site-packages/gcsfs/core.py</span> in <span class="ansi-cyan-fg">_call</span><span class="ansi-blue-fg">(self, method, path, *args, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">    476</span>                 <span class="ansi-green-fg">if</span> retry <span class="ansi-blue-fg">&gt;</span> <span class="ansi-cyan-fg">0</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    477</span>                     time<span class="ansi-blue-fg">.</span>sleep<span class="ansi-blue-fg">(</span>min<span class="ansi-blue-fg">(</span>random<span class="ansi-blue-fg">.</span>random<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span> <span class="ansi-blue-fg">+</span> <span class="ansi-cyan-fg">2</span> <span class="ansi-blue-fg">**</span> <span class="ansi-blue-fg">(</span>retry <span class="ansi-blue-fg">-</span> <span class="ansi-cyan-fg">1</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">,</span> <span class="ansi-cyan-fg">32</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">--&gt; 478</span><span class="ansi-red-fg">                 r = self.session.request(
</span><span class="ansi-green-intense-fg ansi-bold">    479</span>                     method<span class="ansi-blue-fg">,</span>
<span class="ansi-green-intense-fg ansi-bold">    480</span>                     path<span class="ansi-blue-fg">,</span>

<span class="ansi-green-fg">~/miniconda/envs/xarray/lib/python3.8/site-packages/google/auth/transport/requests.py</span> in <span class="ansi-cyan-fg">request</span><span class="ansi-blue-fg">(self, method, url, data, headers, max_allowed_time, timeout, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">    438</span>
<span class="ansi-green-intense-fg ansi-bold">    439</span>         <span class="ansi-green-fg">with</span> TimeoutGuard<span class="ansi-blue-fg">(</span>remaining_time<span class="ansi-blue-fg">)</span> <span class="ansi-green-fg">as</span> guard<span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 440</span><span class="ansi-red-fg">             </span>self<span class="ansi-blue-fg">.</span>credentials<span class="ansi-blue-fg">.</span>before_request<span class="ansi-blue-fg">(</span>auth_request<span class="ansi-blue-fg">,</span> method<span class="ansi-blue-fg">,</span> url<span class="ansi-blue-fg">,</span> request_headers<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    441</span>         remaining_time <span class="ansi-blue-fg">=</span> guard<span class="ansi-blue-fg">.</span>remaining_timeout
<span class="ansi-green-intense-fg ansi-bold">    442</span>

<span class="ansi-green-fg">~/miniconda/envs/xarray/lib/python3.8/site-packages/google/auth/credentials.py</span> in <span class="ansi-cyan-fg">before_request</span><span class="ansi-blue-fg">(self, request, method, url, headers)</span>
<span class="ansi-green-intense-fg ansi-bold">    122</span>         <span class="ansi-red-fg"># the http request.)</span>
<span class="ansi-green-intense-fg ansi-bold">    123</span>         <span class="ansi-green-fg">if</span> <span class="ansi-green-fg">not</span> self<span class="ansi-blue-fg">.</span>valid<span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 124</span><span class="ansi-red-fg">             </span>self<span class="ansi-blue-fg">.</span>refresh<span class="ansi-blue-fg">(</span>request<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    125</span>         self<span class="ansi-blue-fg">.</span>apply<span class="ansi-blue-fg">(</span>headers<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    126</span>

<span class="ansi-green-fg">~/miniconda/envs/xarray/lib/python3.8/site-packages/google/auth/compute_engine/credentials.py</span> in <span class="ansi-cyan-fg">refresh</span><span class="ansi-blue-fg">(self, request)</span>
<span class="ansi-green-intense-fg ansi-bold">    100</span>         <span class="ansi-green-fg">except</span> exceptions<span class="ansi-blue-fg">.</span>TransportError <span class="ansi-green-fg">as</span> caught_exc<span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    101</span>             new_exc <span class="ansi-blue-fg">=</span> exceptions<span class="ansi-blue-fg">.</span>RefreshError<span class="ansi-blue-fg">(</span>caught_exc<span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">--&gt; 102</span><span class="ansi-red-fg">             </span>six<span class="ansi-blue-fg">.</span>raise_from<span class="ansi-blue-fg">(</span>new_exc<span class="ansi-blue-fg">,</span> caught_exc<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    103</span>
<span class="ansi-green-intense-fg ansi-bold">    104</span>     <span class="ansi-blue-fg">@</span>property

<span class="ansi-green-fg">~/miniconda/envs/xarray/lib/python3.8/site-packages/six.py</span> in <span class="ansi-cyan-fg">raise_from</span><span class="ansi-blue-fg">(value, from_value)</span>

<span class="ansi-red-fg">RefreshError</span>: (&#39;Failed to retrieve http://metadata.google.internal/computeMetadata/v1/instance/service-accounts/default/?recursive=true from the Google Compute Enginemetadata service. Status: 404 Response:\nb\&#39;&lt;!DOCTYPE html&gt;\\n&lt;html lang=en&gt;\\n  &lt;meta charset=utf-8&gt;\\n  &lt;meta name=viewport content=&#34;initial-scale=1, minimum-scale=1, width=device-width&#34;&gt;\\n  &lt;title&gt;Error 404 (Not Found)!!1&lt;/title&gt;\\n  &lt;style&gt;\\n    *{margin:0;padding:0}html,code{font:15px/22px arial,sans-serif}html{background:#fff;color:#222;padding:15px}body{margin:7% auto 0;max-width:390px;min-height:180px;padding:30px 0 15px}* &gt; body{background:url(//www.google.com/images/errors/robot.png) 100% 5px no-repeat;padding-right:205px}p{margin:11px 0 22px;overflow:hidden}ins{color:#777;text-decoration:none}a img{border:0}@media screen and (max-width:772px){body{background:none;margin-top:0;max-width:none;padding-right:0}}#logo{background:url(//www.google.com/images/branding/googlelogo/1x/googlelogo_color_150x54dp.png) no-repeat;margin-left:-5px}@media only screen and (min-resolution:192dpi){#logo{background:url(//www.google.com/images/branding/googlelogo/2x/googlelogo_color_150x54dp.png) no-repeat 0% 0%/100% 100%;-moz-border-image:url(//www.google.com/images/branding/googlelogo/2x/googlelogo_color_150x54dp.png) 0}}@media only screen and (-webkit-min-device-pixel-ratio:2){#logo{background:url(//www.google.com/images/branding/googlelogo/2x/googlelogo_color_150x54dp.png) no-repeat;-webkit-background-size:100% 100%}}#logo{display:inline-block;height:54px;width:150px}\\n  &lt;/style&gt;\\n  &lt;a href=//www.google.com/&gt;&lt;span id=logo aria-label=Google&gt;&lt;/span&gt;&lt;/a&gt;\\n  &lt;p&gt;&lt;b&gt;404.&lt;/b&gt; &lt;ins&gt;That\\xe2\\x80\\x99s an error.&lt;/ins&gt;\\n  &lt;p&gt;The requested URL &lt;code&gt;/computeMetadata/v1/instance/service-accounts/default/?recursive=true&lt;/code&gt; was not found on this server.  &lt;ins&gt;That\\xe2\\x80\\x99s all we know.&lt;/ins&gt;\\n\&#39;&#39;, &lt;google.auth.transport.requests._Response object at 0x7f7eecbaad60&gt;)
</pre></div></div>
</div>
<p>Let’s do some basic visualizations of the data, just to make sure it looks reasonable.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">ds</span><span class="o">.</span><span class="n">sst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">vmin</span><span class="o">=-</span><span class="mi">2</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-4-e35d4a17661c&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-fg">----&gt; 1</span><span class="ansi-red-fg"> </span>ds<span class="ansi-blue-fg">.</span>sst<span class="ansi-blue-fg">[</span><span class="ansi-cyan-fg">0</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">.</span>plot<span class="ansi-blue-fg">(</span>vmin<span class="ansi-blue-fg">=</span><span class="ansi-blue-fg">-</span><span class="ansi-cyan-fg">2</span><span class="ansi-blue-fg">,</span> vmax<span class="ansi-blue-fg">=</span><span class="ansi-cyan-fg">30</span><span class="ansi-blue-fg">)</span>

<span class="ansi-red-fg">NameError</span>: name &#39;ds&#39; is not defined
</pre></div></div>
</div>
</div>
<div class="section" id="Basic-Arithmetic">
<h2>Basic Arithmetic<a class="headerlink" href="#Basic-Arithmetic" title="Permalink to this headline">¶</a></h2>
<p>Xarray dataarrays and datasets work seamlessly with arithmetic operators and numpy array functions.</p>
<p>For example, imagine we want to convert the temperature (given in Celsius) to Kelvin:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">sst_kelvin</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">sst</span> <span class="o">+</span> <span class="mf">273.15</span>
<span class="n">sst_kelvin</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-5-8aafa3717775&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-fg">----&gt; 1</span><span class="ansi-red-fg"> </span>sst_kelvin <span class="ansi-blue-fg">=</span> ds<span class="ansi-blue-fg">.</span>sst <span class="ansi-blue-fg">+</span> <span class="ansi-cyan-fg">273.15</span>
<span class="ansi-green-intense-fg ansi-bold">      2</span> sst_kelvin

<span class="ansi-red-fg">NameError</span>: name &#39;ds&#39; is not defined
</pre></div></div>
</div>
<p>The dimensions and coordinates were preseved following the operation.</p>
<div class="admonition warning">
<p>Warning: Although many xarray datasets have a units attribute, which is used in plotting, Xarray does not inherently understand units. However, work is underway to integrate xarray with pint, which will provide full unit-aware operations.</p>
</div>
<p>We can apply more complex functions, including numpy ufuncs, to Xarray objects. Imagine we wanted to compute the following expression as a function of SST (<span class="math notranslate nohighlight">\(\Theta\)</span>) in Kelvin:</p>
<div class="math notranslate nohighlight">
\[f(\Theta) =  0.5 \ln(\Theta^2)\]</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">f</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">sst_kelvin</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">f</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-6-b1326c941926&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-fg">----&gt; 1</span><span class="ansi-red-fg"> </span>f <span class="ansi-blue-fg">=</span> <span class="ansi-cyan-fg">0.5</span> <span class="ansi-blue-fg">*</span> np<span class="ansi-blue-fg">.</span>log<span class="ansi-blue-fg">(</span>sst_kelvin <span class="ansi-blue-fg">**</span> <span class="ansi-cyan-fg">2</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      2</span> f

<span class="ansi-red-fg">NameError</span>: name &#39;sst_kelvin&#39; is not defined
</pre></div></div>
</div>
</div>
<div class="section" id="Applying-Aribtrary-Functions">
<h2>Applying Aribtrary Functions<a class="headerlink" href="#Applying-Aribtrary-Functions" title="Permalink to this headline">¶</a></h2>
<p>It’s awesome that we can call <code class="docutils literal notranslate"><span class="pre">np.log(ds)</span></code> and have it “just work”. However, not all third party libraries work this way.</p>
<p>In this example, we will use functions from the <a class="reference external" href="https://teos-10.github.io/GSW-Python/">Gibbs Seawater Toolkit</a>, a package for the thermodynamics of seawater. This package provides ufuncs that operate on numpy arrays.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">gsw</span>

<span class="c1"># an example function</span>
<span class="c1"># http://www.teos-10.org/pubs/gsw/html/gsw_t90_from_t68.html</span>
gsw.t90_from_t68<span class="o">?</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">gsw</span><span class="o">.</span><span class="n">t90_from_t68</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">sst</span><span class="p">)</span>  <span class="c1"># -&gt; returns a numpy array</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-8-7645601328ad&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-fg">----&gt; 1</span><span class="ansi-red-fg"> </span>gsw<span class="ansi-blue-fg">.</span>t90_from_t68<span class="ansi-blue-fg">(</span>ds<span class="ansi-blue-fg">.</span>sst<span class="ansi-blue-fg">)</span>  <span class="ansi-red-fg"># -&gt; returns a numpy array</span>

<span class="ansi-red-fg">NameError</span>: name &#39;ds&#39; is not defined
</pre></div></div>
</div>
<p>It would be nice to keep our dimensions and coordinates. We can accomplish this with <code class="docutils literal notranslate"><span class="pre">xr.apply_ufunc</span></code>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">xr</span><span class="o">.</span><span class="n">apply_ufunc</span><span class="p">(</span><span class="n">gsw</span><span class="o">.</span><span class="n">t90_from_t68</span><span class="p">,</span> <span class="n">ds</span><span class="o">.</span><span class="n">sst</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-9-409c7da16f18&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-fg">----&gt; 1</span><span class="ansi-red-fg"> </span>xr<span class="ansi-blue-fg">.</span>apply_ufunc<span class="ansi-blue-fg">(</span>gsw<span class="ansi-blue-fg">.</span>t90_from_t68<span class="ansi-blue-fg">,</span> ds<span class="ansi-blue-fg">.</span>sst<span class="ansi-blue-fg">)</span>

<span class="ansi-red-fg">NameError</span>: name &#39;ds&#39; is not defined
</pre></div></div>
</div>
<div class="admonition note">
<p>Note: apply_ufunc is a powerful and mysterious function. It has many options for doing more complicated things. Unfortunately, we don’t have time to go into more depth here. Please consult the <a class="reference external" href="http://xarray.pydata.org/en/latest/generated/xarray.apply_ufunc.html">Xarray docs</a> for more details.</p>
</div>
</div>
<div class="section" id="Reductions">
<h2>Reductions<a class="headerlink" href="#Reductions" title="Permalink to this headline">¶</a></h2>
<p>Just like in numpy, we can reduce xarray DataArrays along any number of axes:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">sst</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">sst</span>
<span class="n">sst</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-10-3babe08c1bf3&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-fg">----&gt; 1</span><span class="ansi-red-fg"> </span>sst <span class="ansi-blue-fg">=</span> ds<span class="ansi-blue-fg">.</span>sst
<span class="ansi-green-intense-fg ansi-bold">      2</span> sst<span class="ansi-blue-fg">.</span>mean<span class="ansi-blue-fg">(</span>axis<span class="ansi-blue-fg">=</span><span class="ansi-cyan-fg">0</span><span class="ansi-blue-fg">)</span>

<span class="ansi-red-fg">NameError</span>: name &#39;ds&#39; is not defined
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">sst</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-11-7251b0bdc54f&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-fg">----&gt; 1</span><span class="ansi-red-fg"> </span>sst<span class="ansi-blue-fg">.</span>mean<span class="ansi-blue-fg">(</span>axis<span class="ansi-blue-fg">=</span><span class="ansi-blue-fg">(</span><span class="ansi-cyan-fg">1</span><span class="ansi-blue-fg">,</span> <span class="ansi-cyan-fg">2</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span>

<span class="ansi-red-fg">NameError</span>: name &#39;sst&#39; is not defined
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">sst</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-12-732315fac3e7&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-fg">----&gt; 1</span><span class="ansi-red-fg"> </span>sst<span class="ansi-blue-fg">.</span>mean<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>

<span class="ansi-red-fg">NameError</span>: name &#39;sst&#39; is not defined
</pre></div></div>
</div>
<p>However, rather than performing reductions on axes (as in numpy), we can perform them on dimensions. This turns out to be a huge convenience, particularly in complex calculations when you can’t easily remember which axis corresponds to which dimension:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">sst</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s2">&quot;time&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-13-38e911cb7f23&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-fg">----&gt; 1</span><span class="ansi-red-fg"> </span>sst<span class="ansi-blue-fg">.</span>mean<span class="ansi-blue-fg">(</span>dim<span class="ansi-blue-fg">=</span><span class="ansi-blue-fg">&#34;time&#34;</span><span class="ansi-blue-fg">)</span>

<span class="ansi-red-fg">NameError</span>: name &#39;sst&#39; is not defined
</pre></div></div>
</div>
<p>All of the standard numpy reductions (e.g. <code class="docutils literal notranslate"><span class="pre">min</span></code>, <code class="docutils literal notranslate"><span class="pre">max</span></code>, <code class="docutils literal notranslate"><span class="pre">sum</span></code>, <code class="docutils literal notranslate"><span class="pre">std</span></code>, etc.) are available</p>
<div class="section" id="Exercise">
<h3>Exercise<a class="headerlink" href="#Exercise" title="Permalink to this headline">¶</a></h3>
<p>Take the mean of <code class="docutils literal notranslate"><span class="pre">sst</span></code> in both longitude and latitude. Make a simple timeseries plot:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># your code here</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="Broadcasting">
<h2>Broadcasting<a class="headerlink" href="#Broadcasting" title="Permalink to this headline">¶</a></h2>
<p>Broadcasting refers to the alignmed of arrays with different numbers of dimensions. Numpy’s broadcasting rules, based on array shape, can sometimes be difficult to understand and remember. Xarray does brodcasting by dimension name, rather than array shape. This is a huge convenience.</p>
<p>Let’s now create two arrays with some dimensions in common. For this example, we will create a “weights” array proportional to cosine of latitude. Modulo a normalization, this is the correct area-weighting factor for data on a regular lat-lon grid.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">lat</span><span class="p">))</span>
<span class="n">weights</span><span class="o">.</span><span class="n">dims</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-15-fadd2073b8a0&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-fg">----&gt; 1</span><span class="ansi-red-fg"> </span>weights <span class="ansi-blue-fg">=</span> np<span class="ansi-blue-fg">.</span>cos<span class="ansi-blue-fg">(</span>np<span class="ansi-blue-fg">.</span>deg2rad<span class="ansi-blue-fg">(</span>ds<span class="ansi-blue-fg">.</span>lat<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      2</span> weights<span class="ansi-blue-fg">.</span>dims

<span class="ansi-red-fg">NameError</span>: name &#39;ds&#39; is not defined
</pre></div></div>
</div>
<p>If we multiply this by SST, it “just works,” and the arrays are broadcasted properly:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">sst</span> <span class="o">*</span> <span class="n">weights</span><span class="p">)</span><span class="o">.</span><span class="n">dims</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-16-5d87be61a6c8&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-fg">----&gt; 1</span><span class="ansi-red-fg"> </span><span class="ansi-blue-fg">(</span>ds<span class="ansi-blue-fg">.</span>sst <span class="ansi-blue-fg">*</span> weights<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">.</span>dims

<span class="ansi-red-fg">NameError</span>: name &#39;ds&#39; is not defined
</pre></div></div>
</div>
<div class="admonition warning">
<p>Warning: If the arrays being broadcasted share a dimension name, but have different coordinates, they will first be aligned using Xarray’s default align settings (including filling missing values with NaNs). If that’s not what you want, it’s best to call align explicitly before broadcasting.</p>
</div>
</div>
<div class="section" id="Weighted-Reductions">
<h2>Weighted Reductions<a class="headerlink" href="#Weighted-Reductions" title="Permalink to this headline">¶</a></h2>
<p>We could imagine computing the weighted spatial mean of SST manually, like this:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">sst_mean</span> <span class="o">=</span> <span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">sst</span> <span class="o">*</span> <span class="n">weights</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;lon&quot;</span><span class="p">,</span> <span class="s2">&quot;lat&quot;</span><span class="p">))</span> <span class="o">/</span> <span class="n">weights</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s2">&quot;lat&quot;</span><span class="p">)</span>
<span class="n">sst_mean</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;This is wrong!&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-17-4de857af3dd4&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-fg">----&gt; 1</span><span class="ansi-red-fg"> </span>sst_mean <span class="ansi-blue-fg">=</span> <span class="ansi-blue-fg">(</span>ds<span class="ansi-blue-fg">.</span>sst <span class="ansi-blue-fg">*</span> weights<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">.</span>sum<span class="ansi-blue-fg">(</span>dim<span class="ansi-blue-fg">=</span><span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">&#34;lon&#34;</span><span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">&#34;lat&#34;</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span> <span class="ansi-blue-fg">/</span> weights<span class="ansi-blue-fg">.</span>sum<span class="ansi-blue-fg">(</span>dim<span class="ansi-blue-fg">=</span><span class="ansi-blue-fg">&#34;lat&#34;</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      2</span> sst_mean<span class="ansi-blue-fg">.</span>plot<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      3</span> plt<span class="ansi-blue-fg">.</span>title<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">&#34;This is wrong!&#34;</span><span class="ansi-blue-fg">)</span>

<span class="ansi-red-fg">NameError</span>: name &#39;ds&#39; is not defined
</pre></div></div>
</div>
<p>That would be wrong, however, because the denominator (<code class="docutils literal notranslate"><span class="pre">weights.sum(dim='lat')</span></code>) needs to be expanded to include the <code class="docutils literal notranslate"><span class="pre">lon</span></code> dimension and modified to account for the missing values (land points).</p>
<p>In general, weighted reductions on multidimensional arrays are complicated. To make it a bit easier, Xarray provides a mechanism for weighted reductions. It does this by creating a special intermediate <code class="docutils literal notranslate"><span class="pre">DataArrayWeighted</span></code> object, to which different reduction operations can applied.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">sst_weighted</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">sst</span><span class="o">.</span><span class="n">weighted</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span>
<span class="n">sst_weighted</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-18-c2850a228a2a&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-fg">----&gt; 1</span><span class="ansi-red-fg"> </span>sst_weighted <span class="ansi-blue-fg">=</span> ds<span class="ansi-blue-fg">.</span>sst<span class="ansi-blue-fg">.</span>weighted<span class="ansi-blue-fg">(</span>weights<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      2</span> sst_weighted

<span class="ansi-red-fg">NameError</span>: name &#39;ds&#39; is not defined
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">sst_weighted</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;lon&quot;</span><span class="p">,</span> <span class="s2">&quot;lat&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Correct Global Mean SST&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-19-3b3c417a51cb&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-fg">----&gt; 1</span><span class="ansi-red-fg"> </span>sst_weighted<span class="ansi-blue-fg">.</span>mean<span class="ansi-blue-fg">(</span>dim<span class="ansi-blue-fg">=</span><span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">&#34;lon&#34;</span><span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">&#34;lat&#34;</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">.</span>plot<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      2</span> plt<span class="ansi-blue-fg">.</span>title<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">&#34;Correct Global Mean SST&#34;</span><span class="ansi-blue-fg">)</span>

<span class="ansi-red-fg">NameError</span>: name &#39;sst_weighted&#39; is not defined
</pre></div></div>
</div>
</div>
<div class="section" id="Groupby">
<h2>Groupby<a class="headerlink" href="#Groupby" title="Permalink to this headline">¶</a></h2>
<p>Xarray copies Pandas’ very useful groupby functionality, enabling the “split / apply / combine” workflow on xarray DataArrays and Datasets.</p>
<p>To provide a physically motivated example, let’s examine a timeseries of SST at a single point.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">ds</span><span class="o">.</span><span class="n">sst</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">lon</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">lat</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-20-a00257a4877c&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-fg">----&gt; 1</span><span class="ansi-red-fg"> </span>ds<span class="ansi-blue-fg">.</span>sst<span class="ansi-blue-fg">.</span>sel<span class="ansi-blue-fg">(</span>lon<span class="ansi-blue-fg">=</span><span class="ansi-cyan-fg">300</span><span class="ansi-blue-fg">,</span> lat<span class="ansi-blue-fg">=</span><span class="ansi-cyan-fg">50</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">.</span>plot<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>

<span class="ansi-red-fg">NameError</span>: name &#39;ds&#39; is not defined
</pre></div></div>
</div>
<p>As we can see from the plot, the timeseries at any one point is totally dominated by the seasonal cycle. We would like to remove this seasonal cycle (called the “climatology”) in order to better see the long-term variaitions in temperature. We can accomplish this using <strong>groupby</strong>.</p>
<p>Before moving forward, w note that xarray correctly parsed the time index, resulting in a Pandas datetime index on the time dimension.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">ds</span><span class="o">.</span><span class="n">time</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-21-8b1314f1565c&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-fg">----&gt; 1</span><span class="ansi-red-fg"> </span>ds<span class="ansi-blue-fg">.</span>time

<span class="ansi-red-fg">NameError</span>: name &#39;ds&#39; is not defined
</pre></div></div>
</div>
<p>The syntax of Xarray’s groupby is almost identical to Pandas.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>ds.groupby<span class="o">?</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Object `ds.groupby` not found.
</pre></div></div>
</div>
<p>The most important argument is <code class="docutils literal notranslate"><span class="pre">group</span></code>: this defines the unique values we will us to “split” the data for grouped analysis. We can pass either a DataArray or a name of a variable in the dataset. Lets first use a DataArray. Just like with Pandas, we can use the time indexe to extract specific components of dates and times. Xarray uses a special syntax for this <code class="docutils literal notranslate"><span class="pre">.dt</span></code>, called the <code class="docutils literal notranslate"><span class="pre">DatetimeAccessor</span></code>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">ds</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">dt</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-23-e7de2e3630a6&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-fg">----&gt; 1</span><span class="ansi-red-fg"> </span>ds<span class="ansi-blue-fg">.</span>time<span class="ansi-blue-fg">.</span>dt

<span class="ansi-red-fg">NameError</span>: name &#39;ds&#39; is not defined
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">ds</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">month</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-24-7bd744979269&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-fg">----&gt; 1</span><span class="ansi-red-fg"> </span>ds<span class="ansi-blue-fg">.</span>time<span class="ansi-blue-fg">.</span>dt<span class="ansi-blue-fg">.</span>month

<span class="ansi-red-fg">NameError</span>: name &#39;ds&#39; is not defined
</pre></div></div>
</div>
<p>ds.time.dt.year</p>
<p>We can use these arrays in a groupby operation:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">gb</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">month</span><span class="p">)</span>
<span class="n">gb</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-25-99e2ca0bec0f&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-fg">----&gt; 1</span><span class="ansi-red-fg"> </span>gb <span class="ansi-blue-fg">=</span> ds<span class="ansi-blue-fg">.</span>groupby<span class="ansi-blue-fg">(</span>ds<span class="ansi-blue-fg">.</span>time<span class="ansi-blue-fg">.</span>dt<span class="ansi-blue-fg">.</span>month<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      2</span> gb

<span class="ansi-red-fg">NameError</span>: name &#39;ds&#39; is not defined
</pre></div></div>
</div>
<p>Xarray also offers a more concise syntax when the variable you’re grouping on is already present in the dataset. This is identical to the previous line:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">gb</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;time.month&quot;</span><span class="p">)</span>
<span class="n">gb</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-26-a37b32065106&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-fg">----&gt; 1</span><span class="ansi-red-fg"> </span>gb <span class="ansi-blue-fg">=</span> ds<span class="ansi-blue-fg">.</span>groupby<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">&#34;time.month&#34;</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      2</span> gb

<span class="ansi-red-fg">NameError</span>: name &#39;ds&#39; is not defined
</pre></div></div>
</div>
<p>Now that the data are split, we can manually iterate over the group. The iterator returns the key (group name) and the value (the actual dataset corresponding to that group) for each group.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">for</span> <span class="n">group_name</span><span class="p">,</span> <span class="n">group_ds</span> <span class="ow">in</span> <span class="n">gb</span><span class="p">:</span>
    <span class="c1"># stop iterating after the first loop</span>
    <span class="k">break</span>
<span class="nb">print</span><span class="p">(</span><span class="n">group_name</span><span class="p">)</span>
<span class="n">group_ds</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-27-7aecdda1db65&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-fg">----&gt; 1</span><span class="ansi-red-fg"> </span><span class="ansi-green-fg">for</span> group_name<span class="ansi-blue-fg">,</span> group_ds <span class="ansi-green-fg">in</span> gb<span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">      2</span>     <span class="ansi-red-fg"># stop iterating after the first loop</span>
<span class="ansi-green-intense-fg ansi-bold">      3</span>     <span class="ansi-green-fg">break</span>
<span class="ansi-green-intense-fg ansi-bold">      4</span> print<span class="ansi-blue-fg">(</span>group_name<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      5</span> group_ds

<span class="ansi-red-fg">NameError</span>: name &#39;gb&#39; is not defined
</pre></div></div>
</div>
<p>Now that we have groups defined, it’s time to “apply” a calculation to the group. Like in Pandas, these calculations can either be:</p>
<ul class="simple">
<li><p><em>aggregation</em>: reduces the size of the group</p></li>
<li><p><em>transformation</em>: preserves the group’s full size</p></li>
</ul>
<p>At then end of the apply step, xarray will automatically combine the aggregated / transformed groups back into a single object.</p>
<p>The most fundamental way to apply is with the <code class="docutils literal notranslate"><span class="pre">.map</span></code> method.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>gb.map<span class="o">?</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Object `gb.map` not found.
</pre></div></div>
</div>
<div class="section" id="Aggregations">
<h3>Aggregations<a class="headerlink" href="#Aggregations" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">.apply</span></code> accepts as its argument a function. We can pass an existing function:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">gb</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-29-5ab839370981&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-fg">----&gt; 1</span><span class="ansi-red-fg"> </span>gb<span class="ansi-blue-fg">.</span>map<span class="ansi-blue-fg">(</span>np<span class="ansi-blue-fg">.</span>mean<span class="ansi-blue-fg">)</span>

<span class="ansi-red-fg">NameError</span>: name &#39;gb&#39; is not defined
</pre></div></div>
</div>
<p>Because we specified no extra arguments (like <code class="docutils literal notranslate"><span class="pre">axis</span></code>) the function was applied over all space and time dimensions. This is not what we wanted. Instead, we could define a custom function. This function takes a single argument–the group dataset–and returns a new dataset to be combined:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[30]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">time_mean</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">a</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s2">&quot;time&quot;</span><span class="p">)</span>


<span class="n">gb</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">time_mean</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-30-96c5472d6699&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-intense-fg ansi-bold">      3</span>
<span class="ansi-green-intense-fg ansi-bold">      4</span>
<span class="ansi-green-fg">----&gt; 5</span><span class="ansi-red-fg"> </span>gb<span class="ansi-blue-fg">.</span>map<span class="ansi-blue-fg">(</span>time_mean<span class="ansi-blue-fg">)</span>

<span class="ansi-red-fg">NameError</span>: name &#39;gb&#39; is not defined
</pre></div></div>
</div>
<p>Like Pandas, xarray’s groupby object has many built-in aggregation operations (e.g. <code class="docutils literal notranslate"><span class="pre">mean</span></code>, <code class="docutils literal notranslate"><span class="pre">min</span></code>, <code class="docutils literal notranslate"><span class="pre">max</span></code>, <code class="docutils literal notranslate"><span class="pre">std</span></code>, etc):</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># this does the same thing as the previous cell</span>
<span class="n">ds_mm</span> <span class="o">=</span> <span class="n">gb</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s2">&quot;time&quot;</span><span class="p">)</span>
<span class="n">ds_mm</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-31-ff1e63d8d6d9&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-intense-fg ansi-bold">      1</span> <span class="ansi-red-fg"># this does the same thing as the previous cell</span>
<span class="ansi-green-fg">----&gt; 2</span><span class="ansi-red-fg"> </span>ds_mm <span class="ansi-blue-fg">=</span> gb<span class="ansi-blue-fg">.</span>mean<span class="ansi-blue-fg">(</span>dim<span class="ansi-blue-fg">=</span><span class="ansi-blue-fg">&#34;time&#34;</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      3</span> ds_mm

<span class="ansi-red-fg">NameError</span>: name &#39;gb&#39; is not defined
</pre></div></div>
</div>
<p>So we did what we wanted to do: calculate the climatology at every point in the dataset. Let’s look at the data a bit.</p>
<p><em>Climatlogy at a specific point in the North Atlantic</em></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[32]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">ds_mm</span><span class="o">.</span><span class="n">sst</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">lon</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">lat</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-32-5ee88c79d630&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-fg">----&gt; 1</span><span class="ansi-red-fg"> </span>ds_mm<span class="ansi-blue-fg">.</span>sst<span class="ansi-blue-fg">.</span>sel<span class="ansi-blue-fg">(</span>lon<span class="ansi-blue-fg">=</span><span class="ansi-cyan-fg">300</span><span class="ansi-blue-fg">,</span> lat<span class="ansi-blue-fg">=</span><span class="ansi-cyan-fg">50</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">.</span>plot<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>

<span class="ansi-red-fg">NameError</span>: name &#39;ds_mm&#39; is not defined
</pre></div></div>
</div>
<p><em>Zonal Mean Climatolgoy</em></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[33]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">ds_mm</span><span class="o">.</span><span class="n">sst</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s2">&quot;lon&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;month&quot;</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=-</span><span class="mi">2</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-33-b96a175c788d&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-fg">----&gt; 1</span><span class="ansi-red-fg"> </span>ds_mm<span class="ansi-blue-fg">.</span>sst<span class="ansi-blue-fg">.</span>mean<span class="ansi-blue-fg">(</span>dim<span class="ansi-blue-fg">=</span><span class="ansi-blue-fg">&#34;lon&#34;</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">.</span>plot<span class="ansi-blue-fg">.</span>contourf<span class="ansi-blue-fg">(</span>x<span class="ansi-blue-fg">=</span><span class="ansi-blue-fg">&#34;month&#34;</span><span class="ansi-blue-fg">,</span> levels<span class="ansi-blue-fg">=</span><span class="ansi-cyan-fg">12</span><span class="ansi-blue-fg">,</span> vmin<span class="ansi-blue-fg">=</span><span class="ansi-blue-fg">-</span><span class="ansi-cyan-fg">2</span><span class="ansi-blue-fg">,</span> vmax<span class="ansi-blue-fg">=</span><span class="ansi-cyan-fg">30</span><span class="ansi-blue-fg">)</span>

<span class="ansi-red-fg">NameError</span>: name &#39;ds_mm&#39; is not defined
</pre></div></div>
</div>
<p><em>Difference between January and July Climatology</em></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[34]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="p">(</span><span class="n">ds_mm</span><span class="o">.</span><span class="n">sst</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">month</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">ds_mm</span><span class="o">.</span><span class="n">sst</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">month</span><span class="o">=</span><span class="mi">7</span><span class="p">))</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">vmax</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-34-4aac4a9295ac&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-fg">----&gt; 1</span><span class="ansi-red-fg"> </span><span class="ansi-blue-fg">(</span>ds_mm<span class="ansi-blue-fg">.</span>sst<span class="ansi-blue-fg">.</span>sel<span class="ansi-blue-fg">(</span>month<span class="ansi-blue-fg">=</span><span class="ansi-cyan-fg">1</span><span class="ansi-blue-fg">)</span> <span class="ansi-blue-fg">-</span> ds_mm<span class="ansi-blue-fg">.</span>sst<span class="ansi-blue-fg">.</span>sel<span class="ansi-blue-fg">(</span>month<span class="ansi-blue-fg">=</span><span class="ansi-cyan-fg">7</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">.</span>plot<span class="ansi-blue-fg">(</span>vmax<span class="ansi-blue-fg">=</span><span class="ansi-cyan-fg">10</span><span class="ansi-blue-fg">)</span>

<span class="ansi-red-fg">NameError</span>: name &#39;ds_mm&#39; is not defined
</pre></div></div>
</div>
</div>
<div class="section" id="Transformations">
<h3>Transformations<a class="headerlink" href="#Transformations" title="Permalink to this headline">¶</a></h3>
<p>Now we want to <em>remove</em> this climatology from the dataset, to examine the residual, called the <em>anomaly</em>, which is the interesting part from a climate perspective. Removing the seasonal climatology is a perfect example of a transformation: it operates over a group, but doesn’t change the size of the dataset. Here is one way to code it</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[35]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">remove_time_mean</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">-</span> <span class="n">x</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s2">&quot;time&quot;</span><span class="p">)</span>


<span class="n">ds_anom</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;time.month&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">remove_time_mean</span><span class="p">)</span>
<span class="n">ds_anom</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-35-da7a7c7f2489&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-intense-fg ansi-bold">      3</span>
<span class="ansi-green-intense-fg ansi-bold">      4</span>
<span class="ansi-green-fg">----&gt; 5</span><span class="ansi-red-fg"> </span>ds_anom <span class="ansi-blue-fg">=</span> ds<span class="ansi-blue-fg">.</span>groupby<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">&#34;time.month&#34;</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">.</span>map<span class="ansi-blue-fg">(</span>remove_time_mean<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      6</span> ds_anom

<span class="ansi-red-fg">NameError</span>: name &#39;ds&#39; is not defined
</pre></div></div>
</div>
<p>Xarray makes these sorts of transformations easy by supporting <em>groupby arithmetic</em>. This concept is easiest explained with an example:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[36]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">gb</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;time.month&quot;</span><span class="p">)</span>
<span class="n">ds_anom</span> <span class="o">=</span> <span class="n">gb</span> <span class="o">-</span> <span class="n">gb</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s2">&quot;time&quot;</span><span class="p">)</span>
<span class="n">ds_anom</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-36-755a9c24487e&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-fg">----&gt; 1</span><span class="ansi-red-fg"> </span>gb <span class="ansi-blue-fg">=</span> ds<span class="ansi-blue-fg">.</span>groupby<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">&#34;time.month&#34;</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      2</span> ds_anom <span class="ansi-blue-fg">=</span> gb <span class="ansi-blue-fg">-</span> gb<span class="ansi-blue-fg">.</span>mean<span class="ansi-blue-fg">(</span>dim<span class="ansi-blue-fg">=</span><span class="ansi-blue-fg">&#34;time&#34;</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      3</span> ds_anom

<span class="ansi-red-fg">NameError</span>: name &#39;ds&#39; is not defined
</pre></div></div>
</div>
<p>Now we can view the climate signal without the overwhelming influence of the seasonal cycle.</p>
<p><em>Timeseries at a single point in the North Atlantic</em></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[37]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">ds_anom</span><span class="o">.</span><span class="n">sst</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">lon</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">lat</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-37-27a5f2ff43da&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-fg">----&gt; 1</span><span class="ansi-red-fg"> </span>ds_anom<span class="ansi-blue-fg">.</span>sst<span class="ansi-blue-fg">.</span>sel<span class="ansi-blue-fg">(</span>lon<span class="ansi-blue-fg">=</span><span class="ansi-cyan-fg">300</span><span class="ansi-blue-fg">,</span> lat<span class="ansi-blue-fg">=</span><span class="ansi-cyan-fg">50</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">.</span>plot<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>

<span class="ansi-red-fg">NameError</span>: name &#39;ds_anom&#39; is not defined
</pre></div></div>
</div>
<p><em>Difference between Jan. 1 2018 and Jan. 1 1960</em></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[38]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="p">(</span><span class="n">ds_anom</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="s2">&quot;2018-01-01&quot;</span><span class="p">)</span> <span class="o">-</span> <span class="n">ds_anom</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="s2">&quot;1960-01-01&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">sst</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-38-c44605f00ba9&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-fg">----&gt; 1</span><span class="ansi-red-fg"> </span><span class="ansi-blue-fg">(</span>ds_anom<span class="ansi-blue-fg">.</span>sel<span class="ansi-blue-fg">(</span>time<span class="ansi-blue-fg">=</span><span class="ansi-blue-fg">&#34;2018-01-01&#34;</span><span class="ansi-blue-fg">)</span> <span class="ansi-blue-fg">-</span> ds_anom<span class="ansi-blue-fg">.</span>sel<span class="ansi-blue-fg">(</span>time<span class="ansi-blue-fg">=</span><span class="ansi-blue-fg">&#34;1960-01-01&#34;</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">.</span>sst<span class="ansi-blue-fg">.</span>plot<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>

<span class="ansi-red-fg">NameError</span>: name &#39;ds_anom&#39; is not defined
</pre></div></div>
</div>
</div>
</div>
<div class="section" id="Grouby-Related:-Resample,-Rolling,-Coarsen">
<h2>Grouby-Related: Resample, Rolling, Coarsen<a class="headerlink" href="#Grouby-Related:-Resample,-Rolling,-Coarsen" title="Permalink to this headline">¶</a></h2>
<p>Resample in xarray is nearly identical to Pandas. It is effectively a group-by operation, and uses the same basic syntax. It can be applied only to time-index dimensions. Here we compute the five-year mean.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[39]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">resample_obj</span> <span class="o">=</span> <span class="n">ds_anom</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="s2">&quot;5Y&quot;</span><span class="p">)</span>
<span class="n">resample_obj</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-39-b23ab643a658&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-fg">----&gt; 1</span><span class="ansi-red-fg"> </span>resample_obj <span class="ansi-blue-fg">=</span> ds_anom<span class="ansi-blue-fg">.</span>resample<span class="ansi-blue-fg">(</span>time<span class="ansi-blue-fg">=</span><span class="ansi-blue-fg">&#34;5Y&#34;</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      2</span> resample_obj

<span class="ansi-red-fg">NameError</span>: name &#39;ds_anom&#39; is not defined
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[40]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">ds_anom_resample</span> <span class="o">=</span> <span class="n">resample_obj</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s2">&quot;time&quot;</span><span class="p">)</span>
<span class="n">ds_anom_resample</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-40-d86cfe59789d&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-fg">----&gt; 1</span><span class="ansi-red-fg"> </span>ds_anom_resample <span class="ansi-blue-fg">=</span> resample_obj<span class="ansi-blue-fg">.</span>mean<span class="ansi-blue-fg">(</span>dim<span class="ansi-blue-fg">=</span><span class="ansi-blue-fg">&#34;time&#34;</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      2</span> ds_anom_resample

<span class="ansi-red-fg">NameError</span>: name &#39;resample_obj&#39; is not defined
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[41]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">ds_anom</span><span class="o">.</span><span class="n">sst</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">lon</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">lat</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">ds_anom_resample</span><span class="o">.</span><span class="n">sst</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">lon</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">lat</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">marker</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-41-6b5998c70413&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-fg">----&gt; 1</span><span class="ansi-red-fg"> </span>ds_anom<span class="ansi-blue-fg">.</span>sst<span class="ansi-blue-fg">.</span>sel<span class="ansi-blue-fg">(</span>lon<span class="ansi-blue-fg">=</span><span class="ansi-cyan-fg">300</span><span class="ansi-blue-fg">,</span> lat<span class="ansi-blue-fg">=</span><span class="ansi-cyan-fg">50</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">.</span>plot<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      2</span> ds_anom_resample<span class="ansi-blue-fg">.</span>sst<span class="ansi-blue-fg">.</span>sel<span class="ansi-blue-fg">(</span>lon<span class="ansi-blue-fg">=</span><span class="ansi-cyan-fg">300</span><span class="ansi-blue-fg">,</span> lat<span class="ansi-blue-fg">=</span><span class="ansi-cyan-fg">50</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">.</span>plot<span class="ansi-blue-fg">(</span>marker<span class="ansi-blue-fg">=</span><span class="ansi-blue-fg">&#34;o&#34;</span><span class="ansi-blue-fg">)</span>

<span class="ansi-red-fg">NameError</span>: name &#39;ds_anom&#39; is not defined
</pre></div></div>
</div>
<div class="admonition note">
<p>Note: resample only works with proper datetime indexes.</p>
</div>
<p>Rolling is also similar to pandas, but can be applied along any dimension. It works with logical coordinates.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[42]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">ds_anom_rolling</span> <span class="o">=</span> <span class="n">ds_anom</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">ds_anom_rolling</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-42-d0bec0355164&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-fg">----&gt; 1</span><span class="ansi-red-fg"> </span>ds_anom_rolling <span class="ansi-blue-fg">=</span> ds_anom<span class="ansi-blue-fg">.</span>rolling<span class="ansi-blue-fg">(</span>time<span class="ansi-blue-fg">=</span><span class="ansi-cyan-fg">12</span><span class="ansi-blue-fg">,</span> center<span class="ansi-blue-fg">=</span><span class="ansi-green-fg">True</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">.</span>mean<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      2</span> ds_anom_rolling

<span class="ansi-red-fg">NameError</span>: name &#39;ds_anom&#39; is not defined
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[43]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">ds_anom</span><span class="o">.</span><span class="n">sst</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">lon</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">lat</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;monthly anom&quot;</span><span class="p">)</span>
<span class="n">ds_anom_resample</span><span class="o">.</span><span class="n">sst</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">lon</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">lat</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;5 year resample&quot;</span>
<span class="p">)</span>
<span class="n">ds_anom_rolling</span><span class="o">.</span><span class="n">sst</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">lon</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">lat</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;12 month rolling mean&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-43-59ccb8545061&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-fg">----&gt; 1</span><span class="ansi-red-fg"> </span>ds_anom<span class="ansi-blue-fg">.</span>sst<span class="ansi-blue-fg">.</span>sel<span class="ansi-blue-fg">(</span>lon<span class="ansi-blue-fg">=</span><span class="ansi-cyan-fg">300</span><span class="ansi-blue-fg">,</span> lat<span class="ansi-blue-fg">=</span><span class="ansi-cyan-fg">50</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">.</span>plot<span class="ansi-blue-fg">(</span>label<span class="ansi-blue-fg">=</span><span class="ansi-blue-fg">&#34;monthly anom&#34;</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      2</span> ds_anom_resample.sst.sel(lon=300, lat=50).plot(
<span class="ansi-green-intense-fg ansi-bold">      3</span>     marker<span class="ansi-blue-fg">=</span><span class="ansi-blue-fg">&#34;o&#34;</span><span class="ansi-blue-fg">,</span> label<span class="ansi-blue-fg">=</span><span class="ansi-blue-fg">&#34;5 year resample&#34;</span>
<span class="ansi-green-intense-fg ansi-bold">      4</span> )
<span class="ansi-green-intense-fg ansi-bold">      5</span> ds_anom_rolling<span class="ansi-blue-fg">.</span>sst<span class="ansi-blue-fg">.</span>sel<span class="ansi-blue-fg">(</span>lon<span class="ansi-blue-fg">=</span><span class="ansi-cyan-fg">300</span><span class="ansi-blue-fg">,</span> lat<span class="ansi-blue-fg">=</span><span class="ansi-cyan-fg">50</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">.</span>plot<span class="ansi-blue-fg">(</span>label<span class="ansi-blue-fg">=</span><span class="ansi-blue-fg">&#34;12 month rolling mean&#34;</span><span class="ansi-blue-fg">)</span>

<span class="ansi-red-fg">NameError</span>: name &#39;ds_anom&#39; is not defined
</pre></div></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">coarsen</span></code> does something similar to <code class="docutils literal notranslate"><span class="pre">resample</span></code>, but without being aware of time. It operates on logical coordinates only but can work on multiple dimensions at a time.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[44]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">ds_anom_coarsen_time</span> <span class="o">=</span> <span class="n">ds_anom</span><span class="o">.</span><span class="n">coarsen</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

<span class="n">ds_anom_rolling</span><span class="o">.</span><span class="n">sst</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">lon</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">lat</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;12 month rolling mean&quot;</span><span class="p">)</span>
<span class="n">ds_anom_coarsen_time</span><span class="o">.</span><span class="n">sst</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">lon</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">lat</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;^&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;12 item coarsen&quot;</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-44-bca84be4e268&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-fg">----&gt; 1</span><span class="ansi-red-fg"> </span>ds_anom_coarsen_time <span class="ansi-blue-fg">=</span> ds_anom<span class="ansi-blue-fg">.</span>coarsen<span class="ansi-blue-fg">(</span>time<span class="ansi-blue-fg">=</span><span class="ansi-cyan-fg">12</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">.</span>mean<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      2</span>
<span class="ansi-green-intense-fg ansi-bold">      3</span> ds_anom_rolling<span class="ansi-blue-fg">.</span>sst<span class="ansi-blue-fg">.</span>sel<span class="ansi-blue-fg">(</span>lon<span class="ansi-blue-fg">=</span><span class="ansi-cyan-fg">300</span><span class="ansi-blue-fg">,</span> lat<span class="ansi-blue-fg">=</span><span class="ansi-cyan-fg">50</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">.</span>plot<span class="ansi-blue-fg">(</span>label<span class="ansi-blue-fg">=</span><span class="ansi-blue-fg">&#34;12 month rolling mean&#34;</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      4</span> ds_anom_coarsen_time.sst.sel(lon=300, lat=50).plot(
<span class="ansi-green-intense-fg ansi-bold">      5</span>     marker<span class="ansi-blue-fg">=</span><span class="ansi-blue-fg">&#34;^&#34;</span><span class="ansi-blue-fg">,</span> label<span class="ansi-blue-fg">=</span><span class="ansi-blue-fg">&#34;12 item coarsen&#34;</span>

<span class="ansi-red-fg">NameError</span>: name &#39;ds_anom&#39; is not defined
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[45]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">%%</span><span class="k">expect_exception</span>
ds_anom_coarsen_space = ds_anom.coarsen(lon=4, lat=4).mean()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-45-f690a99950fa&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-fg">----&gt; 1</span><span class="ansi-red-fg"> </span>ds_anom_coarsen_space <span class="ansi-blue-fg">=</span> ds_anom<span class="ansi-blue-fg">.</span>coarsen<span class="ansi-blue-fg">(</span>lon<span class="ansi-blue-fg">=</span><span class="ansi-cyan-fg">4</span><span class="ansi-blue-fg">,</span> lat<span class="ansi-blue-fg">=</span><span class="ansi-cyan-fg">4</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">.</span>mean<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>

<span class="ansi-red-fg">NameError</span>: name &#39;ds_anom&#39; is not defined
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[46]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">ds_anom_coarsen_space</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">ds_anom</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">lat</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">coarsen</span><span class="p">(</span><span class="n">lon</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">lat</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="p">)</span>
<span class="n">ds_anom_coarsen_space</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-46-a2e5fec66565&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-intense-fg ansi-bold">      1</span> ds_anom_coarsen_space = (
<span class="ansi-green-fg">----&gt; 2</span><span class="ansi-red-fg">     </span>ds_anom<span class="ansi-blue-fg">.</span>isel<span class="ansi-blue-fg">(</span>lat<span class="ansi-blue-fg">=</span>slice<span class="ansi-blue-fg">(</span><span class="ansi-cyan-fg">0</span><span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">-</span><span class="ansi-cyan-fg">1</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">.</span>coarsen<span class="ansi-blue-fg">(</span>lon<span class="ansi-blue-fg">=</span><span class="ansi-cyan-fg">4</span><span class="ansi-blue-fg">,</span> lat<span class="ansi-blue-fg">=</span><span class="ansi-cyan-fg">4</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">.</span>mean<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      3</span> )
<span class="ansi-green-intense-fg ansi-bold">      4</span> ds_anom_coarsen_space

<span class="ansi-red-fg">NameError</span>: name &#39;ds_anom&#39; is not defined
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[47]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">ds_anom_coarsen_space</span><span class="o">.</span><span class="n">sst</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-47-c068f0747247&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-fg">----&gt; 1</span><span class="ansi-red-fg"> </span>ds_anom_coarsen_space<span class="ansi-blue-fg">.</span>sst<span class="ansi-blue-fg">.</span>isel<span class="ansi-blue-fg">(</span>time<span class="ansi-blue-fg">=</span><span class="ansi-cyan-fg">0</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">.</span>plot<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>

<span class="ansi-red-fg">NameError</span>: name &#39;ds_anom_coarsen_space&#39; is not defined
</pre></div></div>
</div>
</div>
<div class="section" id="id1">
<h2>Exercise<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<p>Load the following “basin mask” dataset, and use it to take a weighted average of SST in each ocean basin. Figure out which ocean basins are the warmest and coldest.</p>
<p><strong>Hint:</strong> you will first need to align this dataset with the SST dataset. Use what you learned in the “indexing and alignment” lesson.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[48]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">basin</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span>
    <span class="s2">&quot;http://iridl.ldeo.columbia.edu/SOURCES/.NOAA/.NODC/.WOA09/.Masks/.basin/dods&quot;</span>
<span class="p">)</span>
<span class="n">basin</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[48]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div><svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs>
<symbol id="icon-database" viewBox="0 0 32 32">
<title>Show/Hide data repr</title>
<path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
<path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
<path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
</symbol>
<symbol id="icon-file-text2" viewBox="0 0 32 32">
<title>Show/Hide attributes</title>
<path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
<path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
</symbol>
</defs>
</svg>
<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
 *
 */

:root {
  --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
  --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
  --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
  --xr-border-color: var(--jp-border-color2, #e0e0e0);
  --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
  --xr-background-color: var(--jp-layout-color0, white);
  --xr-background-color-row-even: var(--jp-layout-color1, white);
  --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
}

.xr-wrap {
  min-width: 300px;
  max-width: 700px;
}

.xr-header {
  padding-top: 6px;
  padding-bottom: 6px;
  margin-bottom: 4px;
  border-bottom: solid 1px var(--xr-border-color);
}

.xr-header > div,
.xr-header > ul {
  display: inline;
  margin-top: 0;
  margin-bottom: 0;
}

.xr-obj-type,
.xr-array-name {
  margin-left: 2px;
  margin-right: 10px;
}

.xr-obj-type {
  color: var(--xr-font-color2);
}

.xr-sections {
  padding-left: 0 !important;
  display: grid;
  grid-template-columns: 150px auto auto 1fr 20px 20px;
}

.xr-section-item {
  display: contents;
}

.xr-section-item input {
  display: none;
}

.xr-section-item input + label {
  color: var(--xr-disabled-color);
}

.xr-section-item input:enabled + label {
  cursor: pointer;
  color: var(--xr-font-color2);
}

.xr-section-item input:enabled + label:hover {
  color: var(--xr-font-color0);
}

.xr-section-summary {
  grid-column: 1;
  color: var(--xr-font-color2);
  font-weight: 500;
}

.xr-section-summary > span {
  display: inline-block;
  padding-left: 0.5em;
}

.xr-section-summary-in:disabled + label {
  color: var(--xr-font-color2);
}

.xr-section-summary-in + label:before {
  display: inline-block;
  content: '►';
  font-size: 11px;
  width: 15px;
  text-align: center;
}

.xr-section-summary-in:disabled + label:before {
  color: var(--xr-disabled-color);
}

.xr-section-summary-in:checked + label:before {
  content: '▼';
}

.xr-section-summary-in:checked + label > span {
  display: none;
}

.xr-section-summary,
.xr-section-inline-details {
  padding-top: 4px;
  padding-bottom: 4px;
}

.xr-section-inline-details {
  grid-column: 2 / -1;
}

.xr-section-details {
  display: none;
  grid-column: 1 / -1;
  margin-bottom: 5px;
}

.xr-section-summary-in:checked ~ .xr-section-details {
  display: contents;
}

.xr-array-wrap {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 20px auto;
}

.xr-array-wrap > label {
  grid-column: 1;
  vertical-align: top;
}

.xr-preview {
  color: var(--xr-font-color3);
}

.xr-array-preview,
.xr-array-data {
  padding: 0 5px !important;
  grid-column: 2;
}

.xr-array-data,
.xr-array-in:checked ~ .xr-array-preview {
  display: none;
}

.xr-array-in:checked ~ .xr-array-data,
.xr-array-preview {
  display: inline-block;
}

.xr-dim-list {
  display: inline-block !important;
  list-style: none;
  padding: 0 !important;
  margin: 0;
}

.xr-dim-list li {
  display: inline-block;
  padding: 0;
  margin: 0;
}

.xr-dim-list:before {
  content: '(';
}

.xr-dim-list:after {
  content: ')';
}

.xr-dim-list li:not(:last-child):after {
  content: ',';
  padding-right: 5px;
}

.xr-has-index {
  font-weight: bold;
}

.xr-var-list,
.xr-var-item {
  display: contents;
}

.xr-var-item > div,
.xr-var-item label,
.xr-var-item > .xr-var-name span {
  background-color: var(--xr-background-color-row-even);
  margin-bottom: 0;
}

.xr-var-item > .xr-var-name:hover span {
  padding-right: 5px;
}

.xr-var-list > li:nth-child(odd) > div,
.xr-var-list > li:nth-child(odd) > label,
.xr-var-list > li:nth-child(odd) > .xr-var-name span {
  background-color: var(--xr-background-color-row-odd);
}

.xr-var-name {
  grid-column: 1;
}

.xr-var-dims {
  grid-column: 2;
}

.xr-var-dtype {
  grid-column: 3;
  text-align: right;
  color: var(--xr-font-color2);
}

.xr-var-preview {
  grid-column: 4;
}

.xr-var-name,
.xr-var-dims,
.xr-var-dtype,
.xr-preview,
.xr-attrs dt {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding-right: 10px;
}

.xr-var-name:hover,
.xr-var-dims:hover,
.xr-var-dtype:hover,
.xr-attrs dt:hover {
  overflow: visible;
  width: auto;
  z-index: 1;
}

.xr-var-attrs,
.xr-var-data {
  display: none;
  background-color: var(--xr-background-color) !important;
  padding-bottom: 5px !important;
}

.xr-var-attrs-in:checked ~ .xr-var-attrs,
.xr-var-data-in:checked ~ .xr-var-data {
  display: block;
}

.xr-var-data > table {
  float: right;
}

.xr-var-name span,
.xr-var-data,
.xr-attrs {
  padding-left: 25px !important;
}

.xr-attrs,
.xr-var-attrs,
.xr-var-data {
  grid-column: 1 / -1;
}

dl.xr-attrs {
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-columns: 125px auto;
}

.xr-attrs dt, dd {
  padding: 0;
  margin: 0;
  float: left;
  padding-right: 10px;
  width: auto;
}

.xr-attrs dt {
  font-weight: normal;
  grid-column: 1;
}

.xr-attrs dt:hover span {
  display: inline-block;
  background: var(--xr-background-color);
  padding-right: 10px;
}

.xr-attrs dd {
  grid-column: 2;
  white-space: pre-wrap;
  word-break: break-all;
}

.xr-icon-database,
.xr-icon-file-text2 {
  display: inline-block;
  vertical-align: middle;
  width: 1em;
  height: 1.5em !important;
  stroke-width: 0;
  stroke: currentColor;
  fill: currentColor;
}
</style><div class='xr-wrap'><div class='xr-header'><div class='xr-obj-type'>xarray.Dataset</div></div><ul class='xr-sections'><li class='xr-section-item'><input id='section-c40e274b-ea85-4878-a175-2789c98dfcf6' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-c40e274b-ea85-4878-a175-2789c98dfcf6' class='xr-section-summary'  title='Expand/collapse section'>Dimensions:</label><div class='xr-section-inline-details'><ul class='xr-dim-list'><li><span class='xr-has-index'>X</span>: 360</li><li><span class='xr-has-index'>Y</span>: 180</li><li><span class='xr-has-index'>Z</span>: 33</li></ul></div><div class='xr-section-details'></div></li><li class='xr-section-item'><input id='section-d2338296-ad22-437b-9abc-f7b23ce8c7f2' class='xr-section-summary-in' type='checkbox'  checked><label for='section-d2338296-ad22-437b-9abc-f7b23ce8c7f2' class='xr-section-summary' >Coordinates: <span>(3)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>Y</span></div><div class='xr-var-dims'>(Y)</div><div class='xr-var-dtype'>float32</div><div class='xr-var-preview xr-preview'>-89.5 -88.5 -87.5 ... 88.5 89.5</div><input id='attrs-a6223fa6-536e-4463-b940-93bb1689b63d' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-a6223fa6-536e-4463-b940-93bb1689b63d' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-b193d7f0-5b12-4417-bd59-a041e29750b3' class='xr-var-data-in' type='checkbox'><label for='data-b193d7f0-5b12-4417-bd59-a041e29750b3' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>standard_name :</span></dt><dd>latitude</dd><dt><span>pointwidth :</span></dt><dd>1.0</dd><dt><span>gridtype :</span></dt><dd>0</dd><dt><span>units :</span></dt><dd>degree_north</dd></dl></div><pre class='xr-var-data'>array([-89.5, -88.5, -87.5, -86.5, -85.5, -84.5, -83.5, -82.5, -81.5, -80.5,
       -79.5, -78.5, -77.5, -76.5, -75.5, -74.5, -73.5, -72.5, -71.5, -70.5,
       -69.5, -68.5, -67.5, -66.5, -65.5, -64.5, -63.5, -62.5, -61.5, -60.5,
       -59.5, -58.5, -57.5, -56.5, -55.5, -54.5, -53.5, -52.5, -51.5, -50.5,
       -49.5, -48.5, -47.5, -46.5, -45.5, -44.5, -43.5, -42.5, -41.5, -40.5,
       -39.5, -38.5, -37.5, -36.5, -35.5, -34.5, -33.5, -32.5, -31.5, -30.5,
       -29.5, -28.5, -27.5, -26.5, -25.5, -24.5, -23.5, -22.5, -21.5, -20.5,
       -19.5, -18.5, -17.5, -16.5, -15.5, -14.5, -13.5, -12.5, -11.5, -10.5,
        -9.5,  -8.5,  -7.5,  -6.5,  -5.5,  -4.5,  -3.5,  -2.5,  -1.5,  -0.5,
         0.5,   1.5,   2.5,   3.5,   4.5,   5.5,   6.5,   7.5,   8.5,   9.5,
        10.5,  11.5,  12.5,  13.5,  14.5,  15.5,  16.5,  17.5,  18.5,  19.5,
        20.5,  21.5,  22.5,  23.5,  24.5,  25.5,  26.5,  27.5,  28.5,  29.5,
        30.5,  31.5,  32.5,  33.5,  34.5,  35.5,  36.5,  37.5,  38.5,  39.5,
        40.5,  41.5,  42.5,  43.5,  44.5,  45.5,  46.5,  47.5,  48.5,  49.5,
        50.5,  51.5,  52.5,  53.5,  54.5,  55.5,  56.5,  57.5,  58.5,  59.5,
        60.5,  61.5,  62.5,  63.5,  64.5,  65.5,  66.5,  67.5,  68.5,  69.5,
        70.5,  71.5,  72.5,  73.5,  74.5,  75.5,  76.5,  77.5,  78.5,  79.5,
        80.5,  81.5,  82.5,  83.5,  84.5,  85.5,  86.5,  87.5,  88.5,  89.5],
      dtype=float32)</pre></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>Z</span></div><div class='xr-var-dims'>(Z)</div><div class='xr-var-dtype'>float32</div><div class='xr-var-preview xr-preview'>0.0 10.0 20.0 ... 5000.0 5500.0</div><input id='attrs-84f93f32-f0a1-4e1b-b561-b181b9fa0cfa' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-84f93f32-f0a1-4e1b-b561-b181b9fa0cfa' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-c318ac9a-eb98-46fb-8dd8-09cf1fd0d8f3' class='xr-var-data-in' type='checkbox'><label for='data-c318ac9a-eb98-46fb-8dd8-09cf1fd0d8f3' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>gridtype :</span></dt><dd>0</dd><dt><span>units :</span></dt><dd>m</dd></dl></div><pre class='xr-var-data'>array([   0.,   10.,   20.,   30.,   50.,   75.,  100.,  125.,  150.,  200.,
        250.,  300.,  400.,  500.,  600.,  700.,  800.,  900., 1000., 1100.,
       1200., 1300., 1400., 1500., 1750., 2000., 2500., 3000., 3500., 4000.,
       4500., 5000., 5500.], dtype=float32)</pre></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>X</span></div><div class='xr-var-dims'>(X)</div><div class='xr-var-dtype'>float32</div><div class='xr-var-preview xr-preview'>0.5 1.5 2.5 ... 357.5 358.5 359.5</div><input id='attrs-388608f3-3b18-4119-b99b-99c859cdfacf' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-388608f3-3b18-4119-b99b-99c859cdfacf' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-37dcc8b1-f588-4442-b4b1-16b064f24e3a' class='xr-var-data-in' type='checkbox'><label for='data-37dcc8b1-f588-4442-b4b1-16b064f24e3a' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>standard_name :</span></dt><dd>longitude</dd><dt><span>pointwidth :</span></dt><dd>1.0</dd><dt><span>gridtype :</span></dt><dd>1</dd><dt><span>units :</span></dt><dd>degree_east</dd></dl></div><pre class='xr-var-data'>array([  0.5,   1.5,   2.5, ..., 357.5, 358.5, 359.5], dtype=float32)</pre></li></ul></div></li><li class='xr-section-item'><input id='section-d888d404-7554-4780-9b66-8fd20bb3bf09' class='xr-section-summary-in' type='checkbox'  checked><label for='section-d888d404-7554-4780-9b66-8fd20bb3bf09' class='xr-section-summary' >Data variables: <span>(1)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span>basin</span></div><div class='xr-var-dims'>(Z, Y, X)</div><div class='xr-var-dtype'>float32</div><div class='xr-var-preview xr-preview'>...</div><input id='attrs-1397ee4c-a98f-417e-91e3-b94cf11c3d91' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-1397ee4c-a98f-417e-91e3-b94cf11c3d91' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-0243999f-f926-42d0-9b14-03498e2b7d52' class='xr-var-data-in' type='checkbox'><label for='data-0243999f-f926-42d0-9b14-03498e2b7d52' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>long_name :</span></dt><dd>basin code</dd><dt><span>scale_max :</span></dt><dd>58</dd><dt><span>CLIST :</span></dt><dd>Atlantic Ocean
Pacific Ocean
Indian Ocean
Mediterranean Sea
Baltic Sea
Black Sea
Red Sea
Persian Gulf
Hudson Bay
Southern Ocean
Arctic Ocean
Sea of Japan
Kara Sea
Sulu Sea
Baffin Bay
East Mediterranean
West Mediterranean
Sea of Okhotsk
Banda Sea
Caribbean Sea
Andaman Basin
North Caribbean
Gulf of Mexico
Beaufort Sea
South China Sea
Barents Sea
Celebes Sea
Aleutian Basin
Fiji Basin
North American Basin
West European Basin
Southeast Indian Basin
Coral Sea
East Indian Basin
Central Indian Basin
Southwest Atlantic Basin
Southeast Atlantic Basin
Southeast Pacific Basin
Guatemala Basin
East Caroline Basin
Marianas Basin
Philippine Sea
Arabian Sea
Chile Basin
Somali Basin
Mascarene Basin
Crozet Basin
Guinea Basin
Brazil Basin
Argentine Basin
Tasman Sea
Atlantic Indian Basin
Caspian Sea
Sulu Sea II
Venezuela Basin
Bay of Bengal
Java Sea
East Indian Atlantic Basin</dd><dt><span>valid_min :</span></dt><dd>1</dd><dt><span>valid_max :</span></dt><dd>58</dd><dt><span>scale_min :</span></dt><dd>1</dd><dt><span>units :</span></dt><dd>ids</dd></dl></div><pre class='xr-var-data'>[2138400 values with dtype=float32]</pre></li></ul></div></li><li class='xr-section-item'><input id='section-bc425c6c-513f-44f8-bf32-4d5ae42bc261' class='xr-section-summary-in' type='checkbox'  checked><label for='section-bc425c6c-513f-44f8-bf32-4d5ae42bc261' class='xr-section-summary' >Attributes: <span>(1)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><dl class='xr-attrs'><dt><span>Conventions :</span></dt><dd>IRIDL</dd></dl></div></li></ul></div></div></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="04_plotting_and_visualization.html" class="btn btn-neutral float-right" title="Plotting and Visualization" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="02_working_with_labeled_data.html" class="btn btn-neutral float-left" title="Working with labeled data" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, Xarray Developers

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>